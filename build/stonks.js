"use strict";(()=>{function E(p){let c={};return["utm_campaign","utm_source","utm_medium","utm_term","utm_content"].forEach(l=>{let f=p.get(l);f&&(c[l]=f)}),c}function m(p){if(!p)return;let c=p.split(";"),l={};for(let f of c){let g=f.split("=").map(b=>b.trim());g.length!==2||g[0]===""||g[1]===""||(l[g[0]]=g[1])}return Object.keys(l).length===0?void 0:l}(()=>{if(!document)return;let p=null;window.stonks={event:P,view:$};let c=document.currentScript,l=c?.getAttribute("data-hash-routing")!==null,f={isLocalhost:/^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/.test(location.hostname)||location.protocol==="file:",isHeadlessBrowser:!!(window._phantom||window.__nightmare||window.navigator.webdriver||window.Cypress)},g=c?.getAttribute("data-debug");f.isLocalhost&&g&&console.log(`[onedollarstats]
Script successfully connected! Tracking your localhost as ${g}`);async function b(t,e){navigator.sendBeacon?.(t,e)||fetch(t,{method:"POST",body:e,headers:{"Content-Type":"application/json"},keepalive:!0}).catch(n=>console.error("[onedollarstats] fetch() failed:",n.message))}async function A(t){let e=c?.getAttribute("data-url")||"https://collector.onedollarstats.com/events",n=new URL(location.href),o=c.getAttribute("data-debug"),r=!1;if(o)try{let a=new URL(`https://${o}${n.pathname}`);n.hostname!==a.hostname&&(r=!0,n=a)}catch{return}n.search="","path"in t&&t.path&&(n.pathname=t.path);let i=n.href.replace(/\/$/,""),s=t.referrer??void 0;if(!s){let a=document.referrer&&document.referrer!=="null"?document.referrer:void 0;if(a){let k=new URL(a);k.hostname!==n.hostname&&(s=k.href)}}let u={u:i,e:[{t:t.type,h:l,r:s,p:t.props}]};if(t.utm&&Object.keys(t.utm).length>0&&(u.qs=t.utm),r){u.debug=r;let a=`[onedollarstats]
Event name: ${t.type}
Event collected from: ${i}`;t.props&&Object.keys(t.props).length>0&&(a+=`
Props: ${JSON.stringify(t.props,null,2)}`),s&&(a+=`
Referrer: ${s}`),l&&(a+=`
HashRouting: ${l}`),t.utm&&Object.keys(t.utm).length>0&&(a+=`
UTM: ${t.utm}`),console.log(a)}let d=JSON.stringify(u),h=btoa(d);if(h.length<=1500){let a=new Image(1,1);a.onerror=()=>b(e,d),a.src=`${e}?data=${h}`}else await b(e,d)}async function P(t,e,n){if(w())return;let o={};typeof e=="string"?(o.path=e,n&&(o.props=n)):typeof e=="object"&&(o.props=e);let r=o?.path||void 0;if(!r){let i=document.body?.getAttribute("data-s-path")||document.body?.getAttribute("data-s:path")||document.querySelector('meta[name="stonks-path"]')?.getAttribute("content");i&&(r=i)}A({type:t,props:o?.props,path:r})}function L(t){if(t.type==="auxclick"&&t.button!==1)return;let e=t.target;if(!e)return;let n=!!e.closest("a, button"),o=e,r=0;for(;o;){let i=o.getAttribute("data-s-event")||o.getAttribute("data-s:event");if(i){let s=o.getAttribute("data-s-event-props")||o.getAttribute("data-s:event-props"),u=s?m(s):void 0,d=o.getAttribute("data-s-event-path")||o.getAttribute("data-s:event-path")||void 0;P(i,d??u,u);return}if(o=o.parentElement,r++,!n&&r>=3)break}}async function $(t,e){let n={};typeof t=="string"?(n.path=t,e&&(n.props=e)):typeof t=="object"&&(n.props=t),S({path:n?.path,props:n?.props},!1)}async function S(t,e=!0){if(e&&w())return;let n=new URLSearchParams(location.search),o=E(n),r=t?.path||void 0;if(!r){let s=document.body?.getAttribute("data-s-path")||document.body?.getAttribute("data-s:path")||document.querySelector('meta[name="stonks-path"]')?.getAttribute("content");s&&(r=s)}let i=t.props||void 0;if(!i){let s=c?.getAttribute("data-props"),u=s?m(s)||{}:{},d=document.querySelectorAll("[data-s\\:view-props], [data-s-view-props]");for(let h of Array.from(d)){let v=h.getAttribute("data-s-view-props")||h.getAttribute("data-s:view-props");if(!v)continue;let R=m(v);Object.assign(u,R)}i=u}A({type:"PageView",props:Object.keys(i).length>0?i:void 0,path:r,utm:o})}async function y(){let t=document.querySelector('meta[name="stonks-collect"]')?.getAttribute("content"),e=document.body?.getAttribute("data-s-collect")||document.body?.getAttribute("data-s:collect");if(t==="false"||e==="false"){p=null;return}if(!(c?.getAttribute("data-autocollect")!=="false")&&t!=="true"&&e!=="true"){p=null;return}if(!l&&p===location.pathname){console.warn("Ignoring event PageView - pathname has not changed");return}if(w())return;p=location.pathname;let o=c?.getAttribute("data-props"),r=o?m(o)||{}:{},i=document.querySelectorAll("[data-s\\:view-props], [data-s-view-props]");for(let s of Array.from(i)){let u=s.getAttribute("data-s-view-props")||s.getAttribute("data-s:view-props");if(!u)continue;let d=m(u);Object.assign(r,d)}S({props:Object.keys(r).length>0?r:void 0},!1)}function w(){return!!(f.isLocalhost&&!c?.getAttribute("data-debug")||f.isHeadlessBrowser)}if(window.history.pushState){let t=window.history.pushState;window.history.pushState=function(e,n,o){t.apply(this,[e,n,o]),window.requestAnimationFrame(()=>{y()})},window.addEventListener("popstate",()=>{window.requestAnimationFrame(()=>{y()})})}document.visibilityState!=="visible"?document.addEventListener("visibilitychange",()=>{!p&&document.visibilityState==="visible"&&y()}):y(),document.addEventListener("click",L)})();})();
