"use strict";(()=>{var E=(u,i)=>{window.__stonksModalInit={debugUrl:u,analyticsUrl:i};let c=document.createElement("script");c.src=`${i.replace("/events","")}/modal.js`,c.async=!0,c.onerror=()=>{console.error("[onedollarstats] Failed to load debug modal script"),delete window.__stonksModalInit},document.head.appendChild(c)};var P="https://collector.onedollarstats.com/events";function L(u){let i={};return["utm_campaign","utm_source","utm_medium","utm_term","utm_content"].forEach(c=>{let f=u.get(c);f&&(i[c]=f)}),i}function h(u){if(!u)return;let i=u.split(";"),c={};for(let f of i){let g=f.split("=").map(b=>b.trim());g.length!==2||g[0]===""||g[1]===""||(c[g[0]]=g[1])}return Object.keys(c).length===0?void 0:c}(()=>{if(!document)return;let u=null;window.stonks={event:S,view:_};let i=document.currentScript,c=i?.getAttribute("data-hash-routing")!==null,f={isLocalhost:/^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/.test(location.hostname)||location.protocol==="file:",isHeadlessBrowser:!!(window._phantom||window.__nightmare||window.navigator.webdriver||window.Cypress)};if(f.isLocalhost){let t=i?.getAttribute("data-debug");console.log(`[onedollarstats]
Script successfully connected! ${t?`Tracking your localhost as ${t}`:"Debug domain not set"}`),t&&E(t,i?.getAttribute("data-url")||P)}async function g(t,o,e){if(navigator.sendBeacon?.(t,o)){e(!0);return}fetch(t,{method:"POST",body:o,headers:{"Content-Type":"application/json"},keepalive:!0}).then(()=>e(!0)).catch(n=>{console.error("[onedollarstats] fetch() failed:",n.message),e(!1)})}async function b(t){let o=i?.getAttribute("data-url")||P,e=new URL(location.href),n=i.getAttribute("data-debug"),r=!1;if(n)try{let s=new URL(`https://${n}${e.pathname}`);e.hostname!==s.hostname&&(r=!0,e=s)}catch{return}e.search="","path"in t&&t.path&&(e.pathname=t.path);let l=e.href.replace(/\/$/,""),a=t.referrer??void 0;if(!a){let s=document.referrer&&document.referrer!=="null"?document.referrer:void 0;if(s){let $=new URL(s);$.hostname!==e.hostname&&(a=$.href)}}let d={u:l,e:[{t:t.type,h:c,r:a,p:t.props}]};if(t.utm&&Object.keys(t.utm).length>0&&(d.qs=t.utm),r){d.debug=r;let s=`[onedollarstats]
Event name: ${t.type}
Event collected from: ${l}`;t.props&&Object.keys(t.props).length>0&&(s+=`
Props: ${JSON.stringify(t.props,null,2)}`),a&&(s+=`
Referrer: ${a}`),c&&(s+=`
HashRouting: ${c}`),t.utm&&Object.keys(t.utm).length>0&&(s+=`
UTM: ${t.utm}`),console.log(s)}let p=s=>window.__stonksModalLog?.(`${t.type} ${s?"sent":"failed to send"}`,s),m=JSON.stringify(d),y=new TextEncoder().encode(m),A=String.fromCharCode(...y),R=btoa(A);if(R.length<=1500){let s=new Image(1,1);s.onload=()=>p(!0),s.onerror=()=>g(o,m,p),s.src=`${o}?data=${R}`}else await g(o,m,p)}async function S(t,o,e){if(v())return;let n={};typeof o=="string"?(n.path=o,e&&(n.props=e)):typeof o=="object"&&(n.props=o);let r=n?.path||void 0;if(!r){let l=document.body?.getAttribute("data-s-path")||document.body?.getAttribute("data-s:path")||document.querySelector('meta[name="stonks-path"]')?.getAttribute("content");l&&(r=l)}b({type:t,props:n?.props,path:r})}function U(t){if(t.type==="auxclick"&&t.button!==1)return;let o=t.target;if(!o)return;let e=!!o.closest("a, button"),n=o,r=0;for(;n;){let l=n.getAttribute("data-s-event")||n.getAttribute("data-s:event");if(l){let a=n.getAttribute("data-s-event-props")||n.getAttribute("data-s:event-props"),d=a?h(a):void 0,p=n.getAttribute("data-s-event-path")||n.getAttribute("data-s:event-path")||void 0;S(l,p??d,d);return}if(n=n.parentElement,r++,!e&&r>=3)break}}async function _(t,o){let e={};typeof t=="string"?(e.path=t,o&&(e.props=o)):typeof t=="object"&&(e.props=t),k({path:e?.path,props:e?.props},!1)}async function k(t,o=!0){if(o&&v())return;let e=new URLSearchParams(location.search),n=L(e),r=t?.path||void 0;if(!r){let a=document.body?.getAttribute("data-s-path")||document.body?.getAttribute("data-s:path")||document.querySelector('meta[name="stonks-path"]')?.getAttribute("content");a&&(r=a)}let l=t.props||void 0;if(!l){let a=i?.getAttribute("data-props"),d=a?h(a)||{}:{},p=document.querySelectorAll("[data-s\\:view-props], [data-s-view-props]");for(let m of Array.from(p)){let y=m.getAttribute("data-s-view-props")||m.getAttribute("data-s:view-props");if(!y)continue;let A=h(y);Object.assign(d,A)}l=d}b({type:"PageView",props:Object.keys(l).length>0?l:void 0,path:r,utm:n})}async function w(){let t=document.querySelector('meta[name="stonks-collect"]')?.getAttribute("content"),o=document.body?.getAttribute("data-s-collect")||document.body?.getAttribute("data-s:collect");if(t==="false"||o==="false"){u=null;return}if(!(i?.getAttribute("data-autocollect")!=="false")&&t!=="true"&&o!=="true"){u=null;return}if(!c&&u===location.pathname){console.warn("Ignoring event PageView - pathname has not changed");return}if(v())return;u=location.pathname;let n=i?.getAttribute("data-props"),r=n?h(n)||{}:{},l=document.querySelectorAll("[data-s\\:view-props], [data-s-view-props]");for(let a of Array.from(l)){let d=a.getAttribute("data-s-view-props")||a.getAttribute("data-s:view-props");if(!d)continue;let p=h(d);Object.assign(r,p)}k({props:Object.keys(r).length>0?r:void 0},!1)}function v(){return!!(f.isLocalhost&&!i?.getAttribute("data-debug")||f.isHeadlessBrowser)}if(window.history.pushState){let t=window.history.pushState;window.history.pushState=function(o,e,n){t.apply(this,[o,e,n]),window.requestAnimationFrame(()=>{w()})},window.addEventListener("popstate",()=>{window.requestAnimationFrame(()=>{w()})})}document.visibilityState!=="visible"?document.addEventListener("visibilitychange",()=>{!u&&document.visibilityState==="visible"&&w()}):w(),document.addEventListener("click",U)})();})();
